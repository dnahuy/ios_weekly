{\rtf1\ansi\ansicpg1252\cocoartf2513
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 Times-Roman;\f1\froman\fcharset0 Times-Bold;\f2\fnil\fcharset0 HelveticaNeue-Medium;
\f3\fmodern\fcharset0 Courier;\f4\froman\fcharset0 Times-BoldItalic;\f5\froman\fcharset0 Times-Italic;
\f6\fmodern\fcharset0 Courier-Bold;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red67\green67\blue67;\red66\green163\blue240;
\red39\green127\blue200;\red148\green6\blue75;\red246\green246\blue246;\red38\green38\blue38;\red213\green58\blue6;
\red132\green134\blue132;\red17\green17\blue17;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c33333\c33333\c33333;\cssrgb\c31373\c70588\c95294;
\cssrgb\c18431\c57647\c82353;\cssrgb\c65490\c11373\c36471;\cssrgb\c97255\c97255\c97255;\cssrgb\c20000\c20000\c20000;\cssrgb\c87451\c31373\c0;
\cssrgb\c58824\c59608\c58824;\cssrgb\c8627\c8627\c8627;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}}
\paperw11900\paperh16840\margl1440\margr1440\vieww37900\viewh18580\viewkind0
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://www.ably.io/topic/websockets-swift"}}{\fldrslt 
\f0\fs36 \cf0 https://www.ably.io/topic/websockets-swift}}
\f0\fs36 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\fs24 \cf0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b\fs44 \cf0 Gi\uc0\u7899 i thi\u7879 u
\f0\b0\fs36 \
B\'e0i vi\uc0\u7871 t m\'f4 t\u7843  v\u7873  c\'e1c engineering challenge khi implement client-side WebSockets cho Swift.\
\

\f1\b\fs44 A brief overview
\f0\b0\fs36 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
\cf2 Apple c\'f3 h\uc0\u7895  tr\u7907  \expnd0\expndtw0\kerning0
\'a0{\field{\*\fldinst{HYPERLINK "https://developer.apple.com/documentation/foundation/urlsessionwebsockettask"}}{\fldrslt URLSessionWebSocketTask}} v\'e0 low-level network programming {\field{\*\fldinst{HYPERLINK "https://developer.apple.com/documentation/network/nwprotocolwebsocket"}}{\fldrslt \cf5 NWProtocolWebSocket}}
\f2\fs34 \cf5 \

\f0\fs36 \cf0 \kerning1\expnd0\expndtw0 Raw implementation c\uc0\u7911 a WebSocket th\u432 \u7901 ng kh\'f4ng \u273 \u7911  cho realtime app. Ch\'fang ta c\'f3 th\u7875  d\'f9ng c\'e1c open-source library nh\u432  SocketRocket ho\u7863 c Starscream.\
Nh\uc0\u7919 ng library n\'e0y c\'f3 th\u7875  cung c\u7845 p th\'eam v\'e0i additonal functionality, ch\u7859 ng h\u7841 n nh\u432  TLS ho\u7863 c proxy support.\
Tuy nhi\'ean, nh\uc0\u7919 ng library n\'e0y c\u361 ng ch\u7881  l\'e0 wrapper c\u7911 a WebSocket client, ch\'fang kh\'f4ng cung c\u7845 p functionality on top.\
M\uc0\u7897 t protocol on top th\u432 \u7901 ng \u273 \u432 \u7907 c d\'f9ng, h\u7895  tr\u7907  cho enricher functionality ch\u7859 ng h\u7841 n nh\u432  Pub/Sub. \
\
\pard\pardeftab720\partightenfactor0

\f3\fs28 \cf6 \cb7 \expnd0\expndtw0\kerning0
let\cf8  ably = \cf6 ARTRealtime\cf8 (key: \cf9 "ABLY_API_KEY"\cf8 )\
\cf6 let\cf8  channel = ably.channels.\cf6 get\cf8 (\cf9 "test"\cf8 )\
\
\pard\pardeftab720\partightenfactor0
\cf10 // Publish a message to the test channel\cf8 \
channel.publish(\cf9 "greeting"\cf8 , data: \cf9 "hello"\cf8 )\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\fs36 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\partightenfactor0

\f3\fs28 \cf6 \cb7 \expnd0\expndtw0\kerning0
let\cf8  ably = \cf6 ARTRealtime\cf8 (key: \cf9 "ABLY_API_KEY"\cf8 )\
\cf6 let\cf8  channel = ably.channels.\cf6 get\cf8 (\cf9 "test"\cf8 )\
\
\pard\pardeftab720\partightenfactor0
\cf10 // Subscribe to messages on channel\cf8 \
channel.subscribe(\cf9 "greeting"\cf8 ) \{ message \cf6 in\cf8 \
  print(\cf9 "\\(message.data)"\cf8 )\
\}\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\fs36 \cf0 \cb1 \kerning1\expnd0\expndtw0 \
B\'ean tr\'ean l\'e0 1 protocol cho Pub/Sub \uc0\u273 \u432 \u7907 c d\'f9ng on top WebSockets. M\u7863 c d\'f9 communication \u273 \u432 \u7907 c th\'f4ng qua WebSockets, underlying WebSockets protocol \u273 \'e3 \u273 \u432 \u7907 c \'93\u7849 n\'94 kh\u7887 i developer.\
B\uc0\u7841 n c\'f3 th\u7875  quy\u7871 t \u273 \u7883 nh ch\u7885 n b\u7845 t k\u7923  WebSocket-based protocol n\'e0o m\'e0 h\u7895  tr\u7907  Swift. Tuy nhi\'ean, d\'f9 b\u7841 n ch\u7885 n c\'e1i n\'e0o, b\u7841 n c\u361 ng ph\u7843 i consider \u273 \u7871 n nh\u7919 ng challenges s\u7869  g\u7863 p.\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f1\b\fs44 \cf0 Nh\uc0\u7919 ng c\'e1i c\u7847 n consider
\f0\b0\fs36 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f4\i\b \cf0 Authentication
\f0\i0\b0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f5\i \cf0 Basic authentication:\
\pard\pardeftab720\partightenfactor0

\f3\i0\fs34 \cf3 \expnd0\expndtw0\kerning0
wss://realtime.ably.com/?key=
\f6\b \cf11 MY_API_KEY
\f3\b0 \cf3 &format=json&heartbeats=true&v=1.1&lib=js-web-1.2.1\

\f0\fs36 \cf0 \kerning1\expnd0\expndtw0 Tuy nhi\'ean c\'e1ch n\'e0y c\'f3 nhi\uc0\u7873 u nh\u432 \u7907 c \u273 i\u7875 m.\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f5\i \cf0 Token-based authentication:\

\f0\i0 C\'e1ch n\'e0y hi\uc0\u7879 u qu\u7843  v\'e0 secure h\u417 n so v\u7899 i Basic Authentication v\'e0 t\'e1c gi\u7843  \u273 \u7873  xu\u7845 t s\u7917  d\u7909 ng JSON Web Token (JWT).\
\uc0\u272 \u7889 i v\u7899 i c\'e1ch n\'e0y th\'ec ch\'fang ta s\u7869  g\u7863 p v\'e0i v\u7845 n \u273 \u7873  c\u7847 n gi\u7843 i quy\u7871 t\
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls1\ilvl0\cf0 {\listtext	\uc0\u8226 	}Handle token privileges v\'e0 permissions nh\uc0\u432  th\u7871  n\'e0o?\
{\listtext	\uc0\u8226 	}Set TTL (time to live) nh\uc0\u432  th\u7871  n\'e0o\
{\listtext	\uc0\u8226 	}Renew token nh\uc0\u432  th\u7871  n\'e0o?\
{\listtext	\uc0\u8226 	}Tokens \uc0\u273 \u432 \u7907 c send nh\u432  th\u7871  n\'e0o?\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0
\cf0 \
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f4\i\b \cf0 Network compability v\'e0 fallback transports
\f0\i0\b0 \
S\uc0\u7869  c\'f3 v\'e0i networking issues m\'e0 ch\'fang ta c\'f3 th\u7875  g\u7863 p ph\u7843 i. V\'ed d\u7909  nh\u432  proxy traversal. M\u7897 t v\'e0i serves v\'e0 corporate firewalls s\u7869  block WebSockets connection.\
Port 80 v\'e0 443 l\'e0 standard ports cho Web Access v\'e0 ch\'fang c\uc0\u361 ng support cho WebSocket. Port 80 \u273 \u432 \u7907 c d\'f9ng cho c\'e1c insecure connection v\'ec v\u7853 y n\u7871 u c\'f3 th\u7875  h\'e3y d\'f9ng port 443.\
N\'f3 secure h\uc0\u417 n v\'e0 ng\u259 n ch\u7863 n proxies inspecting connections.\
N\uc0\u7871 u kh\'f4ng th\u7875  d\'f9ng port 443 ho\u7863 c ch\'fang ta bi\u7871 t tr\u432 \u7899 c r\u7857 ng client s\u7869  connect t\u7915  trong corporate firewall, ch\'fang ta c\u7847 n ph\u7843 i support fallback transports ch\u7859 ng h\u7841 n nh\u432  XHR steaming, XHR polling ho\u7863 c JSONP polling.\
\

\f4\i\b Device power v\'e0 heartbeats
\f0\i0\b0 \
WebSocket connection l\'e0 persistent, n\'f3 s\uc0\u7869  t\u7889 n pin \u273 \u7875  n\'f3 c\'f3 th\u7875  active. C\'e0ng nhi\u7873 u hearbeats th\'ec pin s\u7869  c\'e0ng b\u7883  hao nhi\u7873 u. T\'e1c gi\u7843  c\'f3 gi\u7899 i thi\u7879 u 1 c\'e1ch kh\'e1c tr\'ean mobile b\u7857 ng c\'e1ch s\u7917  d\u7909 ng Push Notification c\u7911 a OS.\
V\uc0\u7899 i c\'e1ch ti\u7871 p c\u7853 n n\'e0y, ch\'fang ta c\'f3 th\u7875  kh\'f4ng c\u7847 n duy tr\'ec WebSocket connection active. App c\'f3 th\u7875  \u273 \u432 \u7907 c wake up khi Server send Push Notification.\
Tuy nhi\'ean Push Notification c\'f3 nh\uc0\u432 \u7907 c \u273 i\u7875 m l\'e0 n\'f3 kh\'f4ng cung c\u7845 p Quality of Service guarantee, ngo\'e0i ra n\'f3 c\'f2n c\'f3 \u273 \u7897  tr\u7877  v\'e0 kh\'f4ng c\'f3 th\u7913  t\u7921 .\
Do \uc0\u273 \'f3, quy\u7871 t \u273 \u7883 nh n\'ean d\'f9ng hearbeat hay push notifcation s\u7869  tu\u7923  v\'e0o system requirement v\'e0 use cases.\
\

\f4\i\b Handling reconnection v\'e0 continuity
\f0\i0\b0 \
\uc0\u272 \u7889 i v\u7899 i mobile device th\u432 \u7901 ng c\'f3 th\u7875  s\u7869  g\u7863 p t\'ecnh hu\u7889 ng l\'e0 thay \u273 \u7893 i network condition. Device c\'f3 th\u7875  switch t\u7915  Mobile Data Network sang Wifi ho\u7863 c ph\u7843 i tr\u7843 i qua s\u7921  c\u7889  m\u7841 ng b\u7883  \u273 \u7913 t qu\'e3ng.\
Khi \uc0\u273 \'f3 y\'eau c\u7847 u WebSocket connection ph\u7843 i \u273 \u432 \u7907 c re-established.\
N\uc0\u7871 u ch\'fang ta b\u7855 t bu\u7897 c ph\u7843 i resuming 1 stream ch\'ednh x\'e1c ngay t\u7841 i \u273 i\u7875 m m\'e0 n\'f3 b\u7883  \u273 \u7913 t qu\'e3ng, ch\'fang ta ph\u7843 i implement history/persisted data.\
C\'f3 1 v\'e0i th\uc0\u7913  m\'e0 ch\'fang ta s\u7869  c\u7847 n ph\u7843 i l\u432 u t\'e2m:\
\pard\tx220\tx720\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\li720\fi-720\pardirnatural\partightenfactor0
\ls2\ilvl0\cf0 {\listtext	\uc0\u8226 	}Caching messages in front-end memory\
\ls2\ilvl0{\listtext	\uc0\u8226 	}Moving data to persistent storage\
\ls2\ilvl0{\listtext	\uc0\u8226 	}Resuming a stream\
\ls2\ilvl0{\listtext	\uc0\u8226 	}Backoff mechanism\
}